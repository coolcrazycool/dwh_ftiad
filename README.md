### ДЗ1

### Описание

Был реализован docker-compose файл, состоящий из двух сервисов - master и slave. Для инициализации и настройки каждого сервиса используются .sh файлы, которые монтируются в директорию, с которой начинается инициализация постгреса, у мастера туда же кладем ddl. Скрипт для мастера создает юзера для репликации, подкладывает конфиги, и прописывает доступ для юзера репликации. Для слейва также подкладываем настройки.

Для того, чтобы репликация работала, необходимо, чтобы полностью отработал скрипт мастера, а только потом запускался скрипт слейва - для этого было написано условие на depends on по старту базы.

С ddl все понятно, просто по схеме составил :) Правда price_change изменил на свое усмотрение - product_id как FK, иначе не сходилось немного, так как мы бы не знали истории цен.

view также была написана по заданию - собираем продажи из purchase и deliveries (в них еще ищем актуальную на дату доставки цену товара), объединяем и делаем группировку по полям, которые заданы в задании.

### Запуск

Тут все просто - как и было в задании - просто команда ```docker-compose up```

Минута дается мастеру на инициализацию, после чего поднимается реплика.

### ДЗ2

### Выбор архитектуры

Anchor модель слишком теоретическая, на практике сложно применять. Остается выбор между DV и DV2.0, которые по сути кроме как укладки ключей хешами и нет - ничем не отличаются. Выбор сделал в сторону DV2.0, потому что потенциально на хешах будет побыстрее.

### Генерация DataVault DDL

DDL формировал с помощью dbtVault:

1) Описал raw слой данных - как он формируется на основе наших исходных таблиц в 3НФ, собирая воедино разрозненные данные
2) Описал stage слой, в котором указаны способы формирования хешей, дат и тд
3) Описал raw_vault слой, в котором данные раскладываются по 3 сущностям: hub - существительные (наш объект), link - глаголы (связи объектов) и satellite - прилагательные (изменяемые свойства объектов)

После через `dbt run -m ...` прогнал все 3 слоя, получил итоговый DDL

На основе него инициализировал схему в новой БД

### Debezium

Добавил в docker-compose кафку, дебезиум, настроил их. В дебезиум добавил параметров конвертации типов - numeric.

Инициализация осталась прежней: `docker-compose up`

После необходимо запустить скрипт `debezium/commands.sh` 

### DMP

За DMP в своей реализации сделал python скрипт, который подписал на все топики по таблицам. Далее получая их, раскладываю в DataVault.

Запускается через `python3 dwh_loader_class.py`

На выбор можно писать в CH и в PG, в зависимости от раскомментированного engine в верху файла